# run_iterative_pbls.dag ── one star_id per DAG run
# Run via `condor_submit_dag -f run_iterative_pbls.dag`

# star identifier per SPOC / MAST convention
# ntotchunks: 5000 at runtime; try 4 for debugging (within scatter_single_pbls.sub).

# Iteration 0
JOB Scatter_0   scatter_single_pbls_iter0.sub
VARS Scatter_0 star_id="kplr006184894" iter_ix="0" ntotchunks="5000"
SCRIPT PRE Scatter_0 /usr/bin/python3 clean_directories.py kplr006184894

JOB Merge_0 merge.sub
VARS Merge_0 star_id="kplr006184894" iter_ix="0" threshold="8" maxiter="3"
PARENT Scatter_0 CHILD Merge_0

JOB Mask_0 mask.sub
VARS Mask_0 star_id="kplr006184894" iter_ix="0" threshold="8" maxiter="3"
PARENT Merge_0 CHILD Mask_0

# Iteration 1
JOB Scatter_1   scatter_single_pbls_iterN.sub
VARS Scatter_1 star_id="kplr006184894" iter_ix="1" ntotchunks="5000" prev_ix="0"
PARENT Mask_0 CHILD Scatter_1

JOB Merge_1 merge.sub
VARS Merge_1 star_id="kplr006184894" iter_ix="1" threshold="8" maxiter="3"
PARENT Scatter_1 CHILD Merge_1

JOB Mask_1 mask.sub
VARS Mask_1 star_id="kplr006184894" iter_ix="1" threshold="8" maxiter="3"
PARENT Merge_1 CHILD Mask_1

# Iteration 2
JOB Scatter_2   scatter_single_pbls_iterN.sub
VARS Scatter_2 star_id="kplr006184894" iter_ix="2" ntotchunks="5000" prev_ix="1"
PARENT Mask_1 CHILD Scatter_2

JOB Merge_2 merge.sub
VARS Merge_2 star_id="kplr006184894" iter_ix="2" threshold="8" maxiter="3"
PARENT Scatter_2 CHILD Merge_2

JOB Mask_2 mask.sub
VARS Mask_2 star_id="kplr006184894" iter_ix="2" threshold="8" maxiter="3"
PARENT Merge_2 CHILD Mask_2